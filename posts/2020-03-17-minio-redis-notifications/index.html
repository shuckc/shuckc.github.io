<!doctype html><html lang=en-uk><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Testing minio redis notifications | Tea Engineering Blog</title><link rel=canonical href=https://shucksmith.uk/posts/2020-03-17-minio-redis-notifications/><meta name=description content="Hugo is a general-purpose website framework. Technically speaking, Hugo is a static site generator. Unlike systems that dynamically build a page with each visitor request, Hugo builds pages when you create or update your content. Since websites are viewed far more often than they are edited, Hugo is designed to provide an optimal viewing experience for your websiteâ€™s end users and an ideal writing experience for website."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Testing minio redis notifications"><meta property="og:description" content="Documented at docs.min.io &ldquo;Publish MinIO events via Redis&rdquo;
Terminal 1 runs up local redis, enables password, binds to all if
% docker run --name some-redis -d redis % docker exec -it some-redis bash root@800973395e9f:/data# redis-cli 127.0.0.1:6379> config set requirepass yoursecret OK 127.0.0.1:6379> set bind 0.0.0.0 OK 127.0.0.1:6379> save OK 127.0.0.1:6379> monitor Terminal two runs minio server:
% docker run -p 9000:9000 -e &#34;MINIO_ACCESS_KEY=EXAMPLE&#34; -e &#34;MINIO_SECRET_KEY=wJalrXUtnFE&#34; minio/minio server /data Temrinal three fishes out the docker network ip for redis"><meta property="og:type" content="article"><meta property="og:url" content="https://shucksmith.uk/posts/2020-03-17-minio-redis-notifications/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-03-17T17:00:00+00:00"><meta property="article:modified_time" content="2020-03-17T17:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Testing minio redis notifications"><meta name=twitter:description content="Documented at docs.min.io &ldquo;Publish MinIO events via Redis&rdquo;
Terminal 1 runs up local redis, enables password, binds to all if
% docker run --name some-redis -d redis % docker exec -it some-redis bash root@800973395e9f:/data# redis-cli 127.0.0.1:6379> config set requirepass yoursecret OK 127.0.0.1:6379> set bind 0.0.0.0 OK 127.0.0.1:6379> save OK 127.0.0.1:6379> monitor Terminal two runs minio server:
% docker run -p 9000:9000 -e &#34;MINIO_ACCESS_KEY=EXAMPLE&#34; -e &#34;MINIO_SECRET_KEY=wJalrXUtnFE&#34; minio/minio server /data Temrinal three fishes out the docker network ip for redis"><link rel=stylesheet href=https://shucksmith.uk/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=stylesheet href=/css/default.css><script src=/js/fen_diagram.js defer></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/consultancy>Consultancy</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://shucksmith.uk/consultancy/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&text=Testing%20minio%20redis%20notifications" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&is_video=false&description=Testing%20minio%20redis%20notifications" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Testing%20minio%20redis%20notifications&body=Check out this article: https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&name=Testing%20minio%20redis%20notifications&description=Documented%20at%20docs.min.io%20%26ldquo%3bPublish%20MinIO%20events%20via%20Redis%26rdquo%3b%0aTerminal%201%20runs%20up%20local%20redis%2c%20enables%20password%2c%20binds%20to%20all%20if%0a%25%20docker%20run%20--name%20some-redis%20-d%20redis%20%25%20docker%20exec%20-it%20some-redis%20bash%20root%40800973395e9f%3a%2fdata%23%20redis-cli%20127.0.0.1%3a6379%26gt%3b%20config%20set%20requirepass%20yoursecret%20OK%20127.0.0.1%3a6379%26gt%3b%20set%20bind%200.0.0.0%20OK%20127.0.0.1%3a6379%26gt%3b%20save%20OK%20127.0.0.1%3a6379%26gt%3b%20monitor%20Terminal%20two%20runs%20minio%20server%3a%0a%25%20docker%20run%20-p%209000%3a9000%20-e%20%26quot%3bMINIO_ACCESS_KEY%3dEXAMPLE%26quot%3b%20-e%20%26quot%3bMINIO_SECRET_KEY%3dwJalrXUtnFE%26quot%3b%20minio%2fminio%20server%20%2fdata%20Temrinal%20three%20fishes%20out%20the%20docker%20network%20ip%20for%20redis" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&t=Testing%20minio%20redis%20notifications" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Testing minio redis notifications</h1><div class=meta><div class=postdate><time datetime="2020-03-17 17:00:00 +0000 UTC" itemprop=datePublished>2020-03-17</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>tech</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/redis rel=tag>redis</a>
,
<a class=tag-link href=/tags/minio rel=tag>minio</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><p>Documented at <a href=https://docs.min.io/docs/minio-bucket-notification-guide.html>docs.min.io</a> &ldquo;Publish MinIO events via Redis&rdquo;</p><p>Terminal 1 runs up local redis, enables password, binds to all if</p><pre><code>% docker run --name some-redis -d redis
% docker exec -it some-redis bash
root@800973395e9f:/data# redis-cli
127.0.0.1:6379&gt; config set requirepass yoursecret
OK
127.0.0.1:6379&gt; set bind 0.0.0.0
OK
127.0.0.1:6379&gt; save
OK
127.0.0.1:6379&gt; monitor
</code></pre><p>Terminal two runs minio server:</p><pre><code>% docker run -p 9000:9000 -e &quot;MINIO_ACCESS_KEY=EXAMPLE&quot; -e &quot;MINIO_SECRET_KEY=wJalrXUtnFE&quot; minio/minio server /data
</code></pre><p>Temrinal three fishes out the docker network ip for redis</p><pre><code>% docker ps
CONTAINER ID   IMAGE         COMMAND                  CREATED          STATUS          PORTS                    NAMES
800973395e9f   redis         &quot;docker-entrypoint.sâ€¦&quot;   7 minutes ago    Up 7 minutes    6379/tcp                 some-redis
7f76659ad36a   minio/minio   &quot;/usr/bin/docker-entâ€¦&quot;   18 minutes ago   Up 18 minutes   0.0.0.0:9000-&gt;9000/tcp   gracious_jang
% docker inspect --format '{{ .NetworkSettings.IPAddress }}' 800973395e9f
172.17.0.4
</code></pre><p>Then runs minio mc client:</p><pre><code>% docker run -it --entrypoint=/bin/sh minio/mc
sh-4.4# mc alias set dock http://172.17.0.2:9000/ EXAMPLE wJalrXUtnFE
Added `dock` successfully.
sh-4.4# mc mb dock/test123
Bucket created successfully `dock/test123`.
sh-4.4# mc admin config set dock/ notify_redis:1 address=&quot;172.17.0.4:6379&quot; format=&quot;namespace&quot; key=&quot;bucketevents&quot; password=&quot;yoursecret&quot; queue_dir=&quot;&quot; queue_limit=&quot;0&quot;
Successfully applied new settings.
Please restart your server 'mc admin service restart dock/'.
sh-4.4# mc admin service restart dock/
Restart command successfully sent to `dock/`.
Restarted `dock/` successfully.
</code></pre><p>Running <code>mc admin config set &lt;instance> notify_redis</code> causes the server to open up a socket to redis and test the auth, so check server logs.</p><p>This causes the service in T1 to reload, this time printing a URN on startup</p><pre><code>Restarting on service signal

 You are running an older version of MinIO released 1 month ago
 Update: Run `mc admin update`

Endpoint: http://172.17.0.2:9000  http://127.0.0.1:9000
SQS ARNs: arn:minio:sqs::1:redis

Browser Access:
   http://172.17.0.2:9000  http://127.0.0.1:9000

Object API (Amazon S3 compatible):
   Go:         https://docs.min.io/docs/golang-client-quickstart-guide
   Java:       https://docs.min.io/docs/java-client-quickstart-guide
   Python:     https://docs.min.io/docs/python-client-quickstart-guide
   JavaScript: https://docs.min.io/docs/javascript-client-quickstart-guide
   .NET:       https://docs.min.io/docs/dotnet-client-quickstart-guide
Drive /data does not support O_DIRECT for reads, proceeding to use the drive without O_DIRECT
</code></pre><p>Continuing with minio client</p><pre><code>sh-4.4# mc mb dock/images
Bucket created successfully `dock/images`.
sh-4.4# mc event add dock/images arn:minio:sqs::1:redis
Successfully added arn:minio:sqs::1:redis
sh-4.4# mc event list dock/images
arn:minio:sqs::1:redis   s3:ObjectCreated:*,s3:ObjectRemoved:*,s3:ObjectAccessed:*   Filter:
sh-4.4# touch silly.txt
sh-4.4# mc cp silly.txt dock/images
 0 B / ? â”ƒâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘
</code></pre><p>Which causes the redis cli monitor to emit:</p><pre><code>1616017807.403088 [0 172.17.0.2:50754] &quot;HSET&quot; &quot;bucketevents&quot; &quot;images/silly.txt&quot; &quot;{\&quot;Records\&quot;:[{\&quot;eventVersion\&quot;:\&quot;2.0\&quot;,\&quot;eventSource\&quot;:\&quot;minio:s3\&quot;,\&quot;awsRegion\&quot;:\&quot;\&quot;,\&quot;eventTime\&quot;:\&quot;2021-03-17T21:50:07.400Z\&quot;,\&quot;eventName\&quot;:\&quot;s3:ObjectCreated:Put\&quot;,\&quot;userIdentity\&quot;:{\&quot;principalId\&quot;:\&quot;EXAMPLE\&quot;},\&quot;requestParameters\&quot;:{\&quot;accessKey\&quot;:\&quot;EXAMPLE\&quot;,\&quot;region\&quot;:\&quot;\&quot;,\&quot;sourceIPAddress\&quot;:\&quot;172.17.0.3\&quot;},\&quot;responseElements\&quot;:{\&quot;content-length\&quot;:\&quot;0\&quot;,\&quot;x-amz-request-id\&quot;:\&quot;166D3FA2406CF4BC\&quot;,\&quot;x-minio-deployment-id\&quot;:\&quot;a1991d17-c7a8-4259-8bbf-fb0906f1f5d6\&quot;,\&quot;x-minio-origin-endpoint\&quot;:\&quot;http://172.17.0.2:9000\&quot;},\&quot;s3\&quot;:{\&quot;s3SchemaVersion\&quot;:\&quot;1.0\&quot;,\&quot;configurationId\&quot;:\&quot;Config\&quot;,\&quot;bucket\&quot;:{\&quot;name\&quot;:\&quot;images\&quot;,\&quot;ownerIdentity\&quot;:{\&quot;principalId\&quot;:\&quot;EXAMPLE\&quot;},\&quot;arn\&quot;:\&quot;arn:aws:s3:::images\&quot;},\&quot;object\&quot;:{\&quot;key\&quot;:\&quot;silly.txt\&quot;,\&quot;eTag\&quot;:\&quot;d41d8cd98f00b204e9800998ecf8427e\&quot;,\&quot;contentType\&quot;:\&quot;text/plain\&quot;,\&quot;userMetadata\&quot;:{\&quot;content-type\&quot;:\&quot;text/plain\&quot;},\&quot;sequencer\&quot;:\&quot;166D3FA240CF0AE4\&quot;}},\&quot;source\&quot;:{\&quot;host\&quot;:\&quot;172.17.0.3\&quot;,\&quot;port\&quot;:\&quot;\&quot;,\&quot;userAgent\&quot;:\&quot;MinIO (linux; amd64) minio-go/v7.0.9 mc/RELEASE.2021-02-19T05-34-40Z\&quot;}}]}&quot;
</code></pre></div></article><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/consultancy>Consultancy</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&text=Testing%20minio%20redis%20notifications" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&is_video=false&description=Testing%20minio%20redis%20notifications" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Testing%20minio%20redis%20notifications&body=Check out this article: https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&title=Testing%20minio%20redis%20notifications" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&name=Testing%20minio%20redis%20notifications&description=Documented%20at%20docs.min.io%20%26ldquo%3bPublish%20MinIO%20events%20via%20Redis%26rdquo%3b%0aTerminal%201%20runs%20up%20local%20redis%2c%20enables%20password%2c%20binds%20to%20all%20if%0a%25%20docker%20run%20--name%20some-redis%20-d%20redis%20%25%20docker%20exec%20-it%20some-redis%20bash%20root%40800973395e9f%3a%2fdata%23%20redis-cli%20127.0.0.1%3a6379%26gt%3b%20config%20set%20requirepass%20yoursecret%20OK%20127.0.0.1%3a6379%26gt%3b%20set%20bind%200.0.0.0%20OK%20127.0.0.1%3a6379%26gt%3b%20save%20OK%20127.0.0.1%3a6379%26gt%3b%20monitor%20Terminal%20two%20runs%20minio%20server%3a%0a%25%20docker%20run%20-p%209000%3a9000%20-e%20%26quot%3bMINIO_ACCESS_KEY%3dEXAMPLE%26quot%3b%20-e%20%26quot%3bMINIO_SECRET_KEY%3dwJalrXUtnFE%26quot%3b%20minio%2fminio%20server%20%2fdata%20Temrinal%20three%20fishes%20out%20the%20docker%20network%20ip%20for%20redis" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fshucksmith.uk%2fposts%2f2020-03-17-minio-redis-notifications%2f&t=Testing%20minio%20redis%20notifications" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 Tea Engineering Ltd.</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/consultancy>Consultancy</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script></html>